

### **Вимога (ДИВІТЬСЯ КОД TEST_LAB.py)**
> **Щодо часу за заняття:**
> По кожному предмету задається кількість годин, які мають бути прочитані. Дотримання цієї кількості годин є не жорсткою умовою, де штраф за пропущені чи перечитані години має бути пропорційний їх кількості. Додайте просто цей параметр обрахування у фітнес функцію.



```python
def _calculate_soft_constraints(self):
    penalty = 0
    # Додавання штрафів за недотримання або перевищення кількості годин по предметах (м'яке обмеження)
    for subject in subjects:
        scheduled_lectures = 0
        scheduled_practicals = 0
        for timetable in [self.even_timetable, self.odd_timetable]:
            for time_slot, lessons in timetable.items():
                for lesson in lessons:
                    if lesson.subject.id == subject.id:
                        if lesson.type == 'Лекція':
                            scheduled_lectures += 1
                        elif lesson.type == 'Практика':
                            scheduled_practicals += 1
        # Обчислення різниці між запланованими та необхідними годинами
        diff_lectures = scheduled_lectures - subject.num_lectures
        diff_practicals = scheduled_practicals - subject.num_practicals
        # Додавання штрафу за кожну недодану або перевищену годину (пропорційно різниці)
        penalty += abs(diff_lectures) * 2  # Штраф помножений на 2 для більшої ваги
        penalty += abs(diff_practicals) * 2
    return penalty
```



- **Проходження по всіх предметах:** Метод перебирає всі предмети у списку `subjects`.
  
- **Підрахунок запланованих годин:**
  - Для кожного предмету підраховується кількість запланованих лекцій (`scheduled_lectures`) та практичних занять (`scheduled_practicals`) у обох тижнях (`even_timetable` та `odd_timetable`).
  
- **Обчислення різниці:**
  - `diff_lectures` визначає різницю між запланованими та необхідними лекціями.
  - `diff_practicals` визначає різницю між запланованими та необхідними практичними заняттями.
  
- **Додавання штрафу:**
  - Якщо `diff_lectures` або `diff_practicals` позитивні, це означає перевищення кількості годин.
  - Якщо вони негативні, це означає недотримання кількості годин.
  - В обох випадках штраф додається пропорційно до абсолютної величини різниці, помноженої на коефіцієнт (у цьому випадку **2**). Цей коефіцієнт можна налаштовувати в залежності від важливості цієї умови у загальній фітнес-функції.

#### 2. **Метод `calculate_fitness`**

Цей метод обчислює загальну фітнес-оцінку для розкладу, враховуючи різні штрафи:

```python
def calculate_fitness(self):
    penalty = 0
    # Фітнес для парного тижня
    penalty += self._calculate_fitness_for_week(self.even_timetable)
    # Фітнес для непарного тижня
    penalty += self._calculate_fitness_for_week(self.odd_timetable)
    # Врахування м'яких обмежень по предметах
    penalty += self._calculate_soft_constraints()
    # Захист від ділення на нуль або негативного значення
    if penalty < 0:
        penalty = 0
    self.fitness = 1 / (1 + penalty)
```

**Пояснення:**

- **Додавання штрафів за прогалини та перевищення навантаження:** Спочатку додаються штрафи за прогалини у розкладі для груп та викладачів через метод `_calculate_fitness_for_week`.
  
- **Додавання штрафів за недотримання або перевищення кількості годин по предметах:** Потім додаються штрафи через метод `_calculate_soft_constraints`, який ми описали вище.
  
- **Обчислення фітнес-оцінки:** Загальна фітнес-оцінка обчислюється як `1 / (1 + penalty)`, що гарантує, що фітнес завжди буде в межах `(0, 1]`, де більша оцінка означає кращий розклад з меншими штрафами.

#### 3. **Використання Методів у Генетичному Алгоритмі**

У генетичному алгоритмі ці методи використовуються для оцінки кожного індивіда (розкладу) у популяції:

- **Створення початкової популяції:** Кожен розклад створюється та обчислюється його фітнес за допомогою `calculate_fitness`.
  
- **Вибір найкращих індивідів:** Під час етапу вибору (`selection`) найбільш придатні індивіди обираються на основі їх фітнес-оцінок.
  
- **Кросовер та мутація:** При створенні нових розкладів через кросовер та мутацію, фітнес-оцінки нових розкладів знову обчислюються, враховуючи всі штрафи.

### **Покращення та Налаштування**

1. **Коефіцієнт Штрафу:**
   - У методі `_calculate_soft_constraints` коефіцієнт штрафу встановлений на **2**:
     ```python
     penalty += abs(diff_lectures) * 2
     penalty += abs(diff_practicals) * 2
     ```
   - **Налаштування:** Цей коефіцієнт можна змінювати залежно від того, наскільки важливо дотримуватися кількості годин. Наприклад, якщо недотримання кількості годин є критичним, можна збільшити коефіцієнт до **3** або **4**.

2. **Баланс між Жорсткими та М'якими Обмеженнями:**
   - Жорсткі обмеження (наприклад, конфлікти викладачів, аудиторій тощо) мають більшу вагу у фітнес-функції, щоб гарантувати їх дотримання.
   - М'які обмеження (наприклад, прогалини у розкладі, кількість годин) мають меншу вагу, що дозволяє алгоритму мати певну гнучкість у вирішенні конфліктів.

3. **Додаткові Можливості:**
   - **Врахування пріоритетів:** Можна додати різні пріоритети для різних предметів, щоб деякі предмети мали більшу вагу у штрафах.
   - **Динамічний коефіцієнт:** Змінювати коефіцієнт штрафу під час поколінь для кращої адаптації алгоритму до пошуку оптимального розкладу.

### **Висновок**

Внесення цієї вимоги полягало у додаванні методу `_calculate_soft_constraints` до класу `Schedule`, який обчислює штрафи за недотримання або перевищення кількості годин для кожного предмету. Ці штрафи пропорційні до абсолютної різниці між запланованими та необхідними годинами, що дозволяє генетичному алгоритму оптимізувати розклад з урахуванням цих м'яких обмежень.





















## Звіт по Вимогам для Програми Генерації Розкладу `schedule_generator.py`

### **1. Список Груп та Підгруп**
**Вимога:** 
- Список груп \( G \), у кожної з яких є \( N \) студентів. 
- Поділ на підгрупи приблизно навпіл, який не змінюється протягом навчання.

**Реалізація:**
- **CSV-Файл `groups.csv`:** Містить інформацію про групи, кількість студентів та підгрупи.
- **Клас `Group`:** Відповідає за зберігання даних про групи та їхні підгрупи.
- **Генерація Підгруп:** Якщо предмет вимагає поділу на підгрупи (`requires_subgroups = 'Yes'`), група ділиться на підгрупи рівною кількістю студентів.

### **2. Перелік Предметів для Кожної Групи**
**Вимога:** 
- Для кожної групи перелік предметів \( P_i \) з визначеною кількістю годин \( T \) для семестру, включаючи лекції та практичні/лабораторні.

**Реалізація:**
- **CSV-Файл `subjects.csv`:** Містить інформацію про предмети, групи, кількість лекцій та практичних, вимогу поділу на підгрупи та тип тижня (`weekType`).
- **Клас `Subject`:** Зберігає деталі кожного предмету.
- **Генерація Занять:** Для кожного предмету створюються відповідні заняття (лекції та практичні) з урахуванням кількості годин.

### **3. Список Лекторів з Обмеженнями**
**Вимога:** 
- Список лекторів \( L \) з інформацією про предмети та типи занять, які вони можуть проводити.

**Реалізація:**
- **CSV-Файл `lecturers.csv`:** Містить інформацію про лекторів, предмети, які вони можуть викладати (`subjectsCanTeach`), типи занять (`typesCanTeach`) та максимальну кількість годин на тиждень.
- **Клас `Lecturer`:** Зберігає дані про лекторів та їхні обмеження.
- **Призначення Викладачів:** При створенні заняття випадковим чином обирається викладач з відповідними дозволеними предметами та типами занять.

### **4. Список Аудиторій з Ємністю**
**Вимога:** 
- Список аудиторій \( A \) з інформацією про їхню місткість \( m \).

**Реалізація:**
- **CSV-Файл `auditoriums.csv`:** Містить інформацію про аудиторії та їхню місткість.
- **Клас `Auditorium`:** Зберігає дані про аудиторії.
- **Призначення Аудиторій:** Для кожного заняття випадковим чином обирається аудиторія, яка відповідає вимогам щодо місткості.

### **5. Обмеження на Кількість Пар**
**Вимога:** 
- Максимум 20 пар на тиждень (4 пари на день).

**Реалізація:**
- **Часові Слоти:** Визначені як 5 днів на тиждень по 4 періоди (пари) на день.
- **Обмеження:** Генетичний алгоритм враховує лише доступні часові слоти, забезпечуючи, що не більше 4 пар призначено на день для кожної групи та викладача.

### **6. Випадкова Генерація Даних**
**Вимога:** 
- Дані повинні бути легко змінювані через файли, без потреби змінювати код.

**Реалізація:**
- **CSV-Файли:** Всі основні дані (групи, предмети, лектори, аудиторії) зберігаються у CSV-файлах, що дозволяє легко змінювати параметри без редагування коду.
- **Генерація Розкладу:** Алгоритм використовує дані з CSV-файлів для створення розкладу, що забезпечує гнучкість та масштабованість.

### **7. Читабельний Вивід Розкладу**
**Вимога:** 
- Читабельний вивід розкладу в консолі.

**Реалізація:**
- **Бібліотека `tabulate`:** Використовується для форматованого виводу розкладу у вигляді таблиць.
- **Функція `print_schedule`:** Відображає розклад окремо для парного та непарного тижня з детальною інформацією про кожне заняття.

### **8. Умови Викладачів та Аудиторій**
**Вимога:** 
- Один лектор може проводити лише одне заняття одночасно.
- Одна аудиторія може використовуватися одночасно лише під одне заняття, з винятком лекцій, де в аудиторії може бути декілька груп.

**Реалізація:**
- **Перевірка Подвійних Бронювань:** У фітнес-функції перевіряється, щоб лектори та аудиторії не бронювались одночасно для декількох занять.
- **Лекції:** Дозволяється декілька груп одночасно в аудиторії лише для лекцій, що враховано в логіці призначення аудиторій.

### **9. Стабільність Підгруп**
**Вимога:** 
- Підгрупи не змінюють склад протягом навчання.

**Реалізація:**
- **Ініціалізація Підгруп:** Підгрупи створюються при завантаженні даних і залишаються сталими протягом усього процесу генерації розкладу.
- **Клас `Group`:** Зберігає інформацію про підгрупи, яка не змінюється після ініціалізації.

### **10. Стабільність Розміру Популяції**
**Вимога:** 
- Генетичний алгоритм забезпечує стабільний розмір популяції.

**Реалізація:**
- **Параметри Алгоритму:** Розмір популяції встановлено на 100, а кількість поколінь на 200.
- **Створення та Оновлення Популяції:** Після кожного покоління створюється нова популяція точно такого ж розміру, забезпечуючи стабільність.

---

